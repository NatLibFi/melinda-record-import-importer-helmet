---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push

steps:

  - name: generate-tags
    image: quay.io/natlibfi/drone-gen-tags

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    commands:
      - npm ci
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true

  - name: test
    image: node:12
    commands:
      - npm test

  - name: build
    image: node:12
    commands:
      - npm run build

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: docker
    image: plugins/docker
    settings:
      repo: quay.io/natlibfi/melinda-record-import-importer-helmet
      registry: quay.io
      username:
        from_secret: docker_username
      password:
        from_secret: docker_password
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: docker_username
data: ec0uF6//OlwlniqJWkE2/XzIxcg3QRrTqxdJP27X3pIxMjYcPax/3sEIjo2i9PIVI2U=
---
kind: secret
name: docker_password
data: PBK49xHCjB3VlttK4h5LycAh4mCDdtBmQecsXUt5D/pO1YaP0f3uG1YZh+CJZXbCI8vqpoAUQbNkZYduzTwrNR/xp4gsW2nzZj+1Eg7S5uomlYS9ZWWBykx4rNw=
---
kind: secret
name: ssh_key
data: imQZBUutO5Y5EJFZNxvUDxmay6OJu1HhJRo50SAOuUV2iC9TA9pjNQbyLfqMkjrt6cUcBvm3vd/i6s9oOpUopo7643oXgyMEAgDs7I9KHScOeLuTyY/R9z7zzJyC/RDhVcKs8IBIKmNMx5mKM1GF7/SrdWWavSOnVOipTMHYBRRbmwxDJx672DLTVA6Y4nZ4sbqnCNw5nJiwnZXMEA9VObTh/sHegdCH6Ej+AQjrZoMInX/ux3vAPmXd7EkTsuSTk1YrbC+7G30ZpjGQAZUcBmxcODlNsmMommOMXJZcxh9iJO+sD9rwebtuIvBwQpXcjrH2xLZCCJd8IPViHKitmxmYilIcpE59PfcnoI46b3NYd2OJC5EHBWbLXD7YJ2gEJcqnKwAoTwHKDlufHBbC3UIenf191Q9fvedeeTO9HVnq3+y3rtZwxlLpj8NAnUAq+zCJbKal45C+vP37cGPA7jS3Cth4gCEndRwXNrDMkCGkq3B5bwaj5j+JODS/oI3iAVdqilpxKsHkLfjwDahivbGLs6MCukM7I+nttxcDitjBEL6OW4EGL6E4XNIECKx+62WPtDbnnzmGcFqGg2OpW3i5JZ+j/g92dnVT2GQM3AU9TnSqWWvK2QXh4I37Dss69TszJrzVcw1Wo3o8JtmpVUDQhXSX1y3axrwo+rFSt5CKFIz3JznGCirLJCRaZrxM2sd9P/8y0X8XyueG5QA3N+YeAYXhn5ZpqRop2DRGwwdI07UiRdwsRW64lDEbMxCTrAbFTIS3k+LhOEBagdnbljNYGDyXbtsuald/YVAK1vgbLcfs59JPQdLrRTpCb73zgpEsncvzqYLMazsMRlo0rJVNYLXV9UBsg4zuyjQ75U5zm6B+OQPxuA11eJ0yKIfGpylRg0kGAKKViZ8jSG9aEc388jnjCDfnlAzEewgfnUV/foP/sw+N3AxrhzFT7kk2qz4iywtlkh7gLbdHnVmDJo5D74hqBiZMx6QWx0c2UyQkGPSj2zPw7n1LFg2gdE24Lx7Nezs9dg8zOtLQ6W48YOKB3VRwV3oy5/S+7GKG8q6ufRo7s9FDS7e8zkAvXU0b6MM0VmC+HegfwhfqRv3sMbQKU1v+jRcoi7SmzklTFf+iSscFM1xJ31UHBL3fFgiDoIOkAjPgoJNFdWaH0Gq9PWNPbJPSp/dEnREzYtv/hTo5piT6fx0Tom80hH2oFxQUeN5IdaZ+CYO3KtYr1CkLx+l2VLdRquZ7cln1I0dlpb+cASHhf3PZn0ButV5KawEJWi1JmVDrObf8iK9o4M8E65m4QBon12UiFpJce+btcgW7KXrw6VIwwmoiXgwasb8zJG9eeICoPYnaMLLfQmfcV/8nFQiKqP/KXl8wAjOF4XHyZff4r46CQ2lAwCqfpx9KqZZsJoW4rUwRVebyaFvY8Fkx9KBpbtsSmUAAlIyPwf5MOJ7QUvCYsrHsuOYfLVqgGnGn4oHyDS/avPoGf5Iwl+OynDcGb2zYXyGtV7k4W05Lu/ArHoDiD3cnrXS7elDcosV2JwsW7AEzNkAGZ5INrk8kJj4S5Qrg3ALg8Aas/+WqBfR8SrbDuydYvK6wGOOYE1DCl/DUiY7ZKKqMc1cgdhIOSEyf/lEw3dYvaPz87RdesLXRfrJOzaSvfXpOYB3pPuh7qf6Wq3hVsJILjHcqXaWXKMqhOx/g4+by/6UZ7XII96TJew2LfvztE1TqZLdpS6gsnhGvV/KzzG2+/MDLqDXXAQINxAFevSiTwcaomfRcyq8WQxjyH54SzFKxirMu9A5o56aqstGNPw3zpDMagP8tgeqqOkFB8/tRWe2qGZvVthcy5V+xAOpipXC2qGVR53qTla1rRJvsvJmT/Hxn/4lGLldlX4sYLPsDaLpPfL+UPtNkhe3x7PkzjDq8+76h2D2WcRiVtocV8SKIsma5LPzGLEAe44ukKuc+s+RX/5j+3I99V++wLtoCaNsjubcHVOGebSg/bCoFrsTlTHVHkfi0iSNuz29Ca2AC296qwKfpHu/zjxbTbkxnTW0G+9BvehnaOUKnYvesoDQ4bkYhZQjWrBcqa1WFLjP6gzSZ+/joD6T540/HVDFDIsN1Yx0Ih4htMX/zLRWaGeKOGelRkynOGcsk6dXCit5mizKq0NCJSbkJwkukf94Csme3NE9EVCbEn8D1qgwpPA0VdPc7E35WlMUjHJxo9gS9CUUUGWpL7Vf7WrVQGJGl7I7POLSX6cmaPtsc9ICslpLb97Uy4hQ/q1jdCLtx7/8Y5e25CpRYcViW5NJ7cjcpa2BPrSNUGX1L0EWxDwCOe/PBPnyuF8nWyKKJczE9u/uqvH/hHGoQqk6obEFfjmWHx+iZyTk1q2m8ILsKcWrKW51Pd5VVfHJ8LnPiiBW8VOmzSvvv4iYosTYqRiqn+a6YdpgPv3cYqitvkhZGnLF5nudOANTZf6a20opj8SHXaPScU/exFoJ+rhS+Ws/XdDF2HaaSkDKWSfZ1ewkGvZFhJ8URQLu8Fzm3z6QL1p0zyAT1td4CkkxEO0jAoWP3jqF55OiOEFzTdTEMN98s6csATXZ0M1McLcG6iqQVhbrvhpRqqEIJZxIr5RKL7TwbomJb8tn+NUQv+O39KAAcDi0WZfuUKRT0wK0ZAJQG4nuyMJmT00axUGiTpvniM/uSVm6BehTGgLeBfNyazMjri/vM/g+JipSw/oFUNQ3quhhJzjGHRfQmFtnUrTkEUAz01mCTHIAq7F9o0JqEyisgZPIIM4fvX/8Qbaf8rNxUvBdOJoN0kcKz6oG2sIcgFGIZtDDmDcL1UYvQTp6KXW1q+ZnIau9DMq8ABdDUJigy9L64EKhBg+E2QET5j1/LWOzQzQQGD/4vYmSuh8shBTrgsENQrFyCqOCgAViZ+wPMdfupOysJmydQtt+1TbXFQf4KoStJXTfFHslrCimqQiqM+jxQlYigKvMhy6gdF1covjiemPdEdwCf8OlC4HhzywUCNJKQKYvyRaeuhT5xmoHp8fIXUZs/
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: faa6fe650874143b87e7e3acff2c254350bddcbd32dbf2951ec5708164a253eb

...
